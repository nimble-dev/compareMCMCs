<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">



<title>Overview of compareMCMCs</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' || rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Overview of compareMCMCs</h1>


<div id="TOC">
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#an-example">An example</a></li>
<li><a href="#data-vs.constants-in-nimble-vs.jags-and-winbugsopenbugs">Data vs. constants in nimble vs. JAGS and WinBUGS/OpenBUGS</a></li>
<li><a href="#mcmc-efficiency-and-pace">MCMC efficiency and pace</a><ul>
<li><a href="#what-is-timed">What is timed</a></li>
</ul></li>
<li><a href="#new-mcmc-configurations-in-nimble">New MCMC configurations in nimble</a><ul>
<li><a href="#pre-defined-configurations">Pre-defined configurations</a></li>
</ul></li>
<li><a href="#combining-results-from-different-calls-to-comparemcmcs.">Combining results from different calls to <code>compareMCMCs</code>.</a></li>
<li><a href="#writing-new-comparison-metrics.">Writing new comparison metrics.</a></li>
<li><a href="#converting-parameters-to-match-each-other-across-different-mcmcs">Converting parameters to match each other across different MCMCs</a><ul>
<li><a href="#example">Example</a></li>
<li><a href="#converting-parameters-outside-of-comparemcmcs">Converting parameters outside of <code>compareMCMCs</code></a></li>
<li><a href="#how-to-specify-conversions">How to specify conversions</a></li>
</ul></li>
<li><a href="#writing-new-page-component-plugins.">Writing new page component plugins.</a><ul>
<li><a href="#more-about-the-make-function.">More about the <code>make</code> function.</a></li>
<li><a href="#using-a-new-page-component">Using a new page component</a></li>
<li><a href="#pre-defined-page-components-and-defaults">Pre-defined page components and defaults</a></li>
</ul></li>
<li><a href="#writing-new-mcmc-package-plugins.">Writing new MCMC package plugins.</a></li>
</ul>
</div>

<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p><code>compareMCMCs</code> is a package for running, managing, and comparing results from different MCMC packages. For example, you can configure a set of MCMCs to run and then automatically time them and generate html output with comparisons of efficiency and posterior distributions. This system started life as part of the nimble package. Although it is now a separate package, it remains somewhat nimble-centric.</p>
<p>Right now, <code>compareMCMCs</code> works for nimble and JAGS (via rjags). We plan to add more features before releasing it on CRAN.</p>
<p>Beware that you might need to call the <code>compareMCMCs</code> function as <code>compareMCMCs::compareMCMCs</code>. That’s because there is a deprecated <code>compareMCMCs</code> function in <code>nimble</code>.</p>
<p>Use of other MCMCs is supported by a plugin system. Plugins are provided for JAGS and are planned for WinBUGS, OpenBUGS and Stan. Since nimble, JAGS, WinBUGS and OpenBUGS use different dialects of the same model language, it is sometimes possible to compare them using the same model code. It is possible to write new plugins for new MCMC packages fairly easily.</p>
<p>It is also possible to provide new comparison metrics and/or new figure components for html comparison pages.</p>
<p>In summary, <code>compareMCMCs</code> provides:</p>
<ul>
<li>the <code>compareMCMCs</code> function to run one or more MCMCs and manage the results;</li>
<li>the <code>MCMCresult</code> class to manage results by storing samples, timing information, metrics or summaries of performance, and other details;</li>
<li>a plugin systems to include new MCMC engines;</li>
<li>a plugin system for new metrics for comparison among MCMCs;</li>
<li>a system for applying parameter conversions, in case difference MCMCs use different parameterizations and/or parameter names;</li>
<li>a system for generating html pages with figures from comparison metrics, including a plugin system to provide new page components;</li>
<li>partial backward compatibility to nimble’s original <code>MCMCsuite</code> and <code>compareMCMCs</code> functions.</li>
</ul>
</div>
<div id="an-example" class="section level1">
<h1>An example</h1>
<p>Let’s say you want to compare the performance of adaptive random-walk Metropolis-Hastings sampling, slice sampling with nimble, and JAGS (which will also use slice sampling in this case) for a toy model with only one observation following a gamma distribution, known rate parameter, and unknown shape parameter with a uniform prior distribution. The following code accomplishes this:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(compareMCMCs)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="co">#&gt; Loading required package: R6</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="co">#&gt; Loading required package: nimble</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="co">#&gt; nimble version 0.9.0 is loaded.</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="co">#&gt; For more information on NIMBLE and a User Manual,</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="co">#&gt; please visit http://R-nimble.org.</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="co">#&gt; Attaching package: 'nimble'</span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="co">#&gt; The following object is masked from 'package:stats':</span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="co">#&gt;     simulate</span></a>
<a class="sourceLine" id="cb1-12" data-line-number="12"><span class="co">#&gt; Loading required package: ggplot2</span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13"><span class="co">#&gt; Loading required package: grid</span></a>
<a class="sourceLine" id="cb1-14" data-line-number="14"><span class="co">#&gt; Loading required package: reshape2</span></a>
<a class="sourceLine" id="cb1-15" data-line-number="15"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-16" data-line-number="16"><span class="co">#&gt; Attaching package: 'compareMCMCs'</span></a>
<a class="sourceLine" id="cb1-17" data-line-number="17"><span class="co">#&gt; The following objects are masked from 'package:nimble':</span></a>
<a class="sourceLine" id="cb1-18" data-line-number="18"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-19" data-line-number="19"><span class="co">#&gt;     compareMCMCs, MCMCsuite</span></a>
<a class="sourceLine" id="cb1-20" data-line-number="20">modelCode &lt;-<span class="st"> </span><span class="kw">nimbleCode</span>({</a>
<a class="sourceLine" id="cb1-21" data-line-number="21">  a <span class="op">~</span><span class="st"> </span><span class="kw">dunif</span>(<span class="dv">0</span>, <span class="dv">100</span>)</a>
<a class="sourceLine" id="cb1-22" data-line-number="22">  y <span class="op">~</span><span class="st"> </span><span class="kw">dgamma</span>(a, <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb1-23" data-line-number="23">})</a>
<a class="sourceLine" id="cb1-24" data-line-number="24">modelInfo &lt;-<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb1-25" data-line-number="25">  <span class="dt">code =</span> modelCode,</a>
<a class="sourceLine" id="cb1-26" data-line-number="26">  <span class="dt">constants =</span> <span class="kw">list</span>(<span class="dt">y =</span> <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb1-27" data-line-number="27">  <span class="dt">inits =</span> <span class="kw">list</span>(<span class="dt">a =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb1-28" data-line-number="28">)</a>
<a class="sourceLine" id="cb1-29" data-line-number="29">configure_nimble_slice &lt;-<span class="st"> </span><span class="cf">function</span>(model) {</a>
<a class="sourceLine" id="cb1-30" data-line-number="30">  <span class="kw">configureMCMC</span>(model, <span class="dt">onlySlice =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb1-31" data-line-number="31">}</a>
<a class="sourceLine" id="cb1-32" data-line-number="32">res &lt;-<span class="st"> </span><span class="kw">compareMCMCs</span>(modelInfo,</a>
<a class="sourceLine" id="cb1-33" data-line-number="33">                    <span class="dt">MCMCs =</span> <span class="kw">c</span>(<span class="st">'jags'</span>, <span class="st">'nimble'</span>, <span class="st">'nimble_slice'</span>),</a>
<a class="sourceLine" id="cb1-34" data-line-number="34">                    <span class="dt">nimbleMCMCdefs =</span> </a>
<a class="sourceLine" id="cb1-35" data-line-number="35">                      <span class="kw">list</span>(<span class="dt">nimble_slice =</span> <span class="st">'configure_nimble_slice'</span>),</a>
<a class="sourceLine" id="cb1-36" data-line-number="36">                    <span class="dt">MCMCcontrol =</span> <span class="kw">list</span>(<span class="dt">inits =</span> <span class="kw">list</span>(<span class="dt">a =</span> <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb1-37" data-line-number="37">                                       <span class="dt">niter =</span> <span class="dv">2000</span>,</a>
<a class="sourceLine" id="cb1-38" data-line-number="38">                                       <span class="dt">burnin =</span> <span class="dv">100</span>))</a>
<a class="sourceLine" id="cb1-39" data-line-number="39"><span class="co">#&gt; building nimble model...</span></a>
<a class="sourceLine" id="cb1-40" data-line-number="40"><span class="co">#&gt; defining model...</span></a>
<a class="sourceLine" id="cb1-41" data-line-number="41"><span class="co">#&gt; Detected y as data within 'constants'.</span></a>
<a class="sourceLine" id="cb1-42" data-line-number="42"><span class="co">#&gt; Adding y as data for building model.</span></a>
<a class="sourceLine" id="cb1-43" data-line-number="43"><span class="co">#&gt; building model...</span></a>
<a class="sourceLine" id="cb1-44" data-line-number="44"><span class="co">#&gt; setting data and initial values...</span></a>
<a class="sourceLine" id="cb1-45" data-line-number="45"><span class="co">#&gt; running calculate on model (any error reports that follow may simply reflect missing values in model variables) ... </span></a>
<a class="sourceLine" id="cb1-46" data-line-number="46"><span class="co">#&gt; checking model sizes and dimensions...</span></a>
<a class="sourceLine" id="cb1-47" data-line-number="47"><span class="co">#&gt; model building finished.</span></a>
<a class="sourceLine" id="cb1-48" data-line-number="48"><span class="co">#&gt; Compiling model graph</span></a>
<a class="sourceLine" id="cb1-49" data-line-number="49"><span class="co">#&gt;    Resolving undeclared variables</span></a>
<a class="sourceLine" id="cb1-50" data-line-number="50"><span class="co">#&gt;    Allocating nodes</span></a>
<a class="sourceLine" id="cb1-51" data-line-number="51"><span class="co">#&gt; Graph information:</span></a>
<a class="sourceLine" id="cb1-52" data-line-number="52"><span class="co">#&gt;    Observed stochastic nodes: 1</span></a>
<a class="sourceLine" id="cb1-53" data-line-number="53"><span class="co">#&gt;    Unobserved stochastic nodes: 1</span></a>
<a class="sourceLine" id="cb1-54" data-line-number="54"><span class="co">#&gt;    Total graph size: 6</span></a>
<a class="sourceLine" id="cb1-55" data-line-number="55"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-56" data-line-number="56"><span class="co">#&gt; Initializing model</span></a>
<a class="sourceLine" id="cb1-57" data-line-number="57"><span class="co">#&gt; compiling... this may take a minute. Use 'showCompilerOutput = TRUE' to see C++ compilation details.</span></a>
<a class="sourceLine" id="cb1-58" data-line-number="58"><span class="co">#&gt; compilation finished.</span></a>
<a class="sourceLine" id="cb1-59" data-line-number="59"><span class="co">#&gt; compiling... this may take a minute. Use 'showCompilerOutput = TRUE' to see C++ compilation details.</span></a>
<a class="sourceLine" id="cb1-60" data-line-number="60"><span class="co">#&gt; compilation finished.</span></a>
<a class="sourceLine" id="cb1-61" data-line-number="61"><span class="co">#&gt; |-------------|-------------|-------------|-------------|</span></a>
<a class="sourceLine" id="cb1-62" data-line-number="62"><span class="co">#&gt; |-------------------------------------------------------|</span></a>
<a class="sourceLine" id="cb1-63" data-line-number="63"><span class="co">#&gt; |-------------|-------------|-------------|-------------|</span></a>
<a class="sourceLine" id="cb1-64" data-line-number="64"><span class="co">#&gt; |-------------------------------------------------------|</span></a>
<a class="sourceLine" id="cb1-65" data-line-number="65"><span class="kw">make_MCMC_comparison_pages</span>(res, <span class="dt">modelName =</span> <span class="st">'example1'</span>)</a></code></pre></div>
<p>Results are <a href="example1.html">here</a>. In this case, all samplers are so efficient that the comparison between them is not very stable. On the machine this is being written on, <code>nimble_slice</code> is the most efficient MCMC.</p>
</div>
<div id="data-vs.constants-in-nimble-vs.jags-and-winbugsopenbugs" class="section level1">
<h1>Data vs. constants in nimble vs. JAGS and WinBUGS/OpenBUGS</h1>
<p>When using the same model code for nimble and any of JAGS, WinBUGS or OpenBUGS, it is important to note that nimble makes a distinction between “data” and “constants”, which the other packages group together into “data”. In nimble, constants are values necessary to define a model, such as an “N” in “for(i in 1:N)”, while data are observed scientific data, whose values may be changed when using a nimble model (although they won’t be in MCMC). When both data and constants are provided as “constants” to nimble, it attempts to determine which values should be treated as data. Correspondingly, the constants will be passed to the other packages as data. Therefore, it is advisable to provide both data and constants as “constants” when using both nimble and JAGS, WinBUGS or OpenBUGS. See the NIMBLE User Manual (<a href="http://r-nimble.org" class="uri">http://r-nimble.org</a>) for more information about data and constants in nimble.</p>
</div>
<div id="mcmc-efficiency-and-pace" class="section level1">
<h1>MCMC efficiency and pace</h1>
<p>MCMC efficiency is defined as the effective sample size divided by computation time (in seconds). This is the rate (per second) at which effectively independent samples are generated.</p>
<p>MCMC pace is the inverse of MCMC efficiency. It is the time (in seconds) required to generate one effectively independent sample.</p>
<div id="what-is-timed" class="section level2">
<h2>What is timed</h2>
<p>Because the primary interest motivating this package is comparison of MCMC algorithms, the computation time used to calculate MCMC efficiency and pace is the MCMC run time. It does not include the time to set up a run, such as the time nimble spends building and compiling the model and algorithm. However, that time is recorded in each <code>MCMCresult</code> object (see below).</p>
</div>
</div>
<div id="new-mcmc-configurations-in-nimble" class="section level1">
<h1>New MCMC configurations in nimble</h1>
<p>NIMBLE provides the capability to customize an MCMC configuration, choosing samplers, writing new samplers, and arranging sampler order. To have <code>compareMCMCs</code> use a custom configuration, the steps are:</p>
<ol style="list-style-type: decimal">
<li>Choose a name for the configuration, such as “nimble_slice” above. Include that name in the <code>MCMCs</code> argument. Some names are pre-defined, such as “nimble” and “jags”. (Actually, “nimble_slice” is provided as a pre-defined configuration. We have just used it as an example.)</li>
<li>Provide an element in the <code>nimbleMCMCdefs</code> list with the same name as entered in <code>MCMCs</code> (e.g., “nimble_slice”). That element can take one of three formats:
<ol style="list-style-type: lower-roman">
<li>A function, which should take a nimble model as its first and only argument and return an MCMC configuration (e.g., what is returned by <code>configureMCMC</code>).</li>
<li>The character <em>name</em> of a function as described in (i).</li>
<li>An R code object such as that created by <code>quote</code>. This can assume there is an object called <code>Rmodel</code> that is a nimble model. It should return an MCMC configuration. An example that would work above is <code>nimbleMCMCdefs = list(nimble_slice = quote({configureMCMC(Rmodel, onlySlice = TRUE)}))</code>. The curly braces can contain as many lines of code as needed.</li>
</ol></li>
</ol>
<div id="pre-defined-configurations" class="section level3">
<h3>Pre-defined configurations</h3>
<p>The package comes with the following configurations:</p>
<ul>
<li>“nimble_slice”</li>
<li>“nimble_noConj”</li>
<li>“nimble_RW”</li>
<li>“autoBlock”</li>
</ul>
</div>
</div>
<div id="combining-results-from-different-calls-to-comparemcmcs." class="section level1">
<h1>Combining results from different calls to <code>compareMCMCs</code>.</h1>
<p>Results are stored as a list of <code>MCMCresult</code> objects, so it is possible to simply concatenate lists to combine results. This makes it possible to run and save results separately and combine them later for comparison purposes.</p>
<p>For example, the above example could be created as follows:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">res_jags &lt;-<span class="st"> </span><span class="kw">compareMCMCs</span>(modelInfo,</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">                <span class="dt">MCMCs =</span> <span class="kw">c</span>(<span class="st">'jags'</span>),</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">                <span class="dt">MCMCcontrol =</span> <span class="kw">list</span>(<span class="dt">inits =</span> <span class="kw">list</span>(<span class="dt">a =</span> <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">                                   <span class="dt">niter =</span> <span class="dv">2000</span>,</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">                                   <span class="dt">burnin =</span> <span class="dv">100</span>))</a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="co">#&gt; building nimble model...</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="co">#&gt; defining model...</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="co">#&gt; Detected y as data within 'constants'.</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="co">#&gt; Adding y as data for building model.</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10"><span class="co">#&gt; building model...</span></a>
<a class="sourceLine" id="cb2-11" data-line-number="11"><span class="co">#&gt; setting data and initial values...</span></a>
<a class="sourceLine" id="cb2-12" data-line-number="12"><span class="co">#&gt; running calculate on model (any error reports that follow may simply reflect missing values in model variables) ... </span></a>
<a class="sourceLine" id="cb2-13" data-line-number="13"><span class="co">#&gt; checking model sizes and dimensions...</span></a>
<a class="sourceLine" id="cb2-14" data-line-number="14"><span class="co">#&gt; model building finished.</span></a>
<a class="sourceLine" id="cb2-15" data-line-number="15"><span class="co">#&gt; Compiling model graph</span></a>
<a class="sourceLine" id="cb2-16" data-line-number="16"><span class="co">#&gt;    Resolving undeclared variables</span></a>
<a class="sourceLine" id="cb2-17" data-line-number="17"><span class="co">#&gt;    Allocating nodes</span></a>
<a class="sourceLine" id="cb2-18" data-line-number="18"><span class="co">#&gt; Graph information:</span></a>
<a class="sourceLine" id="cb2-19" data-line-number="19"><span class="co">#&gt;    Observed stochastic nodes: 1</span></a>
<a class="sourceLine" id="cb2-20" data-line-number="20"><span class="co">#&gt;    Unobserved stochastic nodes: 1</span></a>
<a class="sourceLine" id="cb2-21" data-line-number="21"><span class="co">#&gt;    Total graph size: 6</span></a>
<a class="sourceLine" id="cb2-22" data-line-number="22"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb2-23" data-line-number="23"><span class="co">#&gt; Initializing model</span></a>
<a class="sourceLine" id="cb2-24" data-line-number="24"><span class="co">## Perhaps we want to run nimble MCMCs for twice as many iterations</span></a>
<a class="sourceLine" id="cb2-25" data-line-number="25">res_nimble &lt;-<span class="st"> </span><span class="kw">compareMCMCs</span>(modelInfo,</a>
<a class="sourceLine" id="cb2-26" data-line-number="26">                <span class="dt">MCMCs =</span> <span class="kw">c</span>(<span class="st">'nimble'</span>, <span class="st">'nimble_slice'</span>),</a>
<a class="sourceLine" id="cb2-27" data-line-number="27">                <span class="dt">nimbleMCMCdefs =</span> <span class="kw">list</span>(<span class="dt">nimble_slice =</span> <span class="st">'configure_nimble_slice'</span>),</a>
<a class="sourceLine" id="cb2-28" data-line-number="28">                <span class="dt">MCMCcontrol =</span> <span class="kw">list</span>(<span class="dt">inits =</span> <span class="kw">list</span>(<span class="dt">a =</span> <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb2-29" data-line-number="29">                                   <span class="dt">niter =</span> <span class="dv">4000</span>, <span class="co">## potentially different than above</span></a>
<a class="sourceLine" id="cb2-30" data-line-number="30">                                   <span class="dt">burnin =</span> <span class="dv">200</span>))</a>
<a class="sourceLine" id="cb2-31" data-line-number="31"><span class="co">#&gt; building nimble model...</span></a>
<a class="sourceLine" id="cb2-32" data-line-number="32"><span class="co">#&gt; defining model...</span></a>
<a class="sourceLine" id="cb2-33" data-line-number="33"><span class="co">#&gt; Detected y as data within 'constants'.</span></a>
<a class="sourceLine" id="cb2-34" data-line-number="34"><span class="co">#&gt; Adding y as data for building model.</span></a>
<a class="sourceLine" id="cb2-35" data-line-number="35"><span class="co">#&gt; building model...</span></a>
<a class="sourceLine" id="cb2-36" data-line-number="36"><span class="co">#&gt; setting data and initial values...</span></a>
<a class="sourceLine" id="cb2-37" data-line-number="37"><span class="co">#&gt; running calculate on model (any error reports that follow may simply reflect missing values in model variables) ... </span></a>
<a class="sourceLine" id="cb2-38" data-line-number="38"><span class="co">#&gt; checking model sizes and dimensions...</span></a>
<a class="sourceLine" id="cb2-39" data-line-number="39"><span class="co">#&gt; model building finished.</span></a>
<a class="sourceLine" id="cb2-40" data-line-number="40"><span class="co">#&gt; compiling... this may take a minute. Use 'showCompilerOutput = TRUE' to see C++ compilation details.</span></a>
<a class="sourceLine" id="cb2-41" data-line-number="41"><span class="co">#&gt; compilation finished.</span></a>
<a class="sourceLine" id="cb2-42" data-line-number="42"><span class="co">#&gt; compiling... this may take a minute. Use 'showCompilerOutput = TRUE' to see C++ compilation details.</span></a>
<a class="sourceLine" id="cb2-43" data-line-number="43"><span class="co">#&gt; compilation finished.</span></a>
<a class="sourceLine" id="cb2-44" data-line-number="44"><span class="co">#&gt; |-------------|-------------|-------------|-------------|</span></a>
<a class="sourceLine" id="cb2-45" data-line-number="45"><span class="co">#&gt; |-------------------------------------------------------|</span></a>
<a class="sourceLine" id="cb2-46" data-line-number="46"><span class="co">#&gt; |-------------|-------------|-------------|-------------|</span></a>
<a class="sourceLine" id="cb2-47" data-line-number="47"><span class="co">#&gt; |-------------------------------------------------------|</span></a>
<a class="sourceLine" id="cb2-48" data-line-number="48">res &lt;-<span class="st"> </span><span class="kw">c</span>(res_jags, res_nimble)</a>
<a class="sourceLine" id="cb2-49" data-line-number="49"><span class="kw">make_MCMC_comparison_pages</span>(res, <span class="dt">modelName =</span> <span class="st">'example2'</span>)</a></code></pre></div>
</div>
<div id="writing-new-comparison-metrics." class="section level1">
<h1>Writing new comparison metrics.</h1>
<p>The result of <code>compareMCMCs</code> is a list of <code>MCMCresult</code> objects. Each <code>MCMCresult</code> has elements for <code>times</code> and <code>metrics</code>. The <code>metrics</code> is a list of metrics organized by their relationship to model parameters. Metrics that have a single value for each MCMC sample are stored in the <code>byMCMC</code> element of <code>metrics</code>. Metrics that have a value for each parameter in each MCMC sample are stored in the <code>byParameter</code> elemement of <code>metrics</code>. Finally, there is an <code>other</code> element of <code>metrics</code> that is a list available for storing any arbitrary kinds of metrics (or any kind of information really) for each MCMC.</p>
<p>For example, here are the metrics of the result for nimble with default samplers above:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">res<span class="op">$</span>nimble<span class="op">$</span>metrics</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="co">#&gt; $byMCMC</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="co">#&gt;     MCMC min_efficiency_coda mean_efficiency_coda</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="co">#&gt; 1 nimble            255689.9             255689.9</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="co">#&gt; $byParameter</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="co">#&gt;     MCMC Parameter     mean   median       sd CI95_low CI95_upp ESS_coda</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="co">#&gt; 1 nimble         a 4.921152 4.698877 2.058471 1.700996 9.527633 767.0696</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="co">#&gt;   efficiency_coda</span></a>
<a class="sourceLine" id="cb3-10" data-line-number="10"><span class="co">#&gt; 1        255689.9</span></a>
<a class="sourceLine" id="cb3-11" data-line-number="11"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb3-12" data-line-number="12"><span class="co">#&gt; $other</span></a>
<a class="sourceLine" id="cb3-13" data-line-number="13"><span class="co">#&gt; list()</span></a></code></pre></div>
<p>A new comparison metric can be provided as a function. It takes as input a <code>MCMCresult</code> object and returns a list with elements named <code>byMCMC</code>, <code>byParameter</code>, and/or <code>other</code>. A result in <code>byParameter</code> should be a list whose names are metric names. Each list element should be a named vector with names corresponding to parameters.</p>
<p>For example, the metric function for median looks like this:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">MCMCmetric_median &lt;-<span class="st"> </span><span class="cf">function</span>(result) {</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">  res &lt;-<span class="st"> </span><span class="kw">apply</span>(result<span class="op">$</span>samples, <span class="dv">2</span>, median)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">  <span class="kw">list</span>(<span class="dt">byParameter =</span> <span class="kw">list</span>(<span class="dt">median =</span> res))</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">}</a></code></pre></div>
<p>There are two ways metrics can be used:</p>
<ol style="list-style-type: decimal">
<li>By calling <code>addMetrics</code> with a list of metrics that could be functions or registered metric names.</li>
<li>By registering it with a name and including that name in the <code>metrics</code> argument to <code>compareMCMCs</code>.</li>
</ol>
<p>Let us look at an example of each. Say we want to make a metric that calculates the 25th and 75th percentiles (i.e. the quartiles) for each parameter and also records the maximum difference between these percentiles across all parameters. We would do so as follows:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">MCMCmetric_quartiles &lt;-<span class="st"> </span><span class="cf">function</span>(result) {</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">  p25 &lt;-<span class="st"> </span><span class="kw">apply</span>(result<span class="op">$</span>samples, <span class="dv">2</span>, quantile, <span class="dt">probs =</span> <span class="fl">0.25</span>)</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">  p75 &lt;-<span class="st"> </span><span class="kw">apply</span>(result<span class="op">$</span>samples, <span class="dv">2</span>, quantile, <span class="dt">probs =</span> <span class="fl">0.75</span>)</a>
<a class="sourceLine" id="cb5-4" data-line-number="4">  <span class="co">## q25 and q75 are named vectors with names matching model parameters</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5">  <span class="co">## i.e. column names of result$samples</span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6">  maxDiff &lt;-<span class="st"> </span><span class="kw">max</span>(p75<span class="op">-</span>p25)</a>
<a class="sourceLine" id="cb5-7" data-line-number="7">  <span class="kw">list</span>(<span class="dt">byParameter =</span> <span class="kw">list</span>(<span class="dt">p25 =</span> p25,</a>
<a class="sourceLine" id="cb5-8" data-line-number="8">                          <span class="dt">p75 =</span> p75),</a>
<a class="sourceLine" id="cb5-9" data-line-number="9">       <span class="dt">byMCMC =</span> <span class="kw">list</span>(<span class="dt">maxQuartileDiff =</span> maxDiff))</a>
<a class="sourceLine" id="cb5-10" data-line-number="10">}</a></code></pre></div>
<p>Note that familiarity with the contents of a <code>MCMCresults</code> object is needed to provide a new metric.</p>
<p>We can now add the metric to the set of stored metric results from our previous results:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw">addMetrics</span>(res, <span class="kw">list</span>(MCMCmetric_quartiles))</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">res<span class="op">$</span>nimble<span class="op">$</span>metrics</a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="co">#&gt; $byMCMC</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="co">#&gt;     MCMC min_efficiency_coda mean_efficiency_coda maxQuartileDiff</span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="co">#&gt; 1 nimble            255689.9             255689.9        2.851056</span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb6-7" data-line-number="7"><span class="co">#&gt; $byParameter</span></a>
<a class="sourceLine" id="cb6-8" data-line-number="8"><span class="co">#&gt;     MCMC Parameter     mean   median       sd CI95_low CI95_upp ESS_coda</span></a>
<a class="sourceLine" id="cb6-9" data-line-number="9"><span class="co">#&gt; 1 nimble         a 4.921152 4.698877 2.058471 1.700996 9.527633 767.0696</span></a>
<a class="sourceLine" id="cb6-10" data-line-number="10"><span class="co">#&gt;   efficiency_coda      p25      p75</span></a>
<a class="sourceLine" id="cb6-11" data-line-number="11"><span class="co">#&gt; 1        255689.9 3.403027 6.254083</span></a>
<a class="sourceLine" id="cb6-12" data-line-number="12"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb6-13" data-line-number="13"><span class="co">#&gt; $other</span></a>
<a class="sourceLine" id="cb6-14" data-line-number="14"><span class="co">#&gt; list()</span></a></code></pre></div>
<p>To register a metric so that it can be called by name, use</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw">registerMetrics</span>(</a>
<a class="sourceLine" id="cb7-2" data-line-number="2">  <span class="kw">list</span>(<span class="dt">quartiles =</span> MCMCmetric_quartiles)</a>
<a class="sourceLine" id="cb7-3" data-line-number="3">)</a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="co">#&gt; &lt;environment: 0x7fe1a129c468&gt;</span></a></code></pre></div>
<p>Now the name “quartiles” can be included in the <code>metrics</code> argument to <code>compareMCMCs</code> or <code>addMetrics</code>, and the registered <code>MCMCmetric_quartiles</code> will be called.</p>
</div>
<div id="converting-parameters-to-match-each-other-across-different-mcmcs" class="section level1">
<h1>Converting parameters to match each other across different MCMCs</h1>
<p>Sometimes different MCMCs for essentially the same model use different parameter names and/or parameterizations. For example, a common difference in parameterization occurs for the variance of a normal distribution, which might be parameterized as variance, standard deviation, log standard deviation, precision, log precision, and so on. compareMCMCs provides a system to support converting parameters to make them comparable across MCMCs. Like metrics, conversions can be applied as part of <code>compareMCMCs</code> or outside of <code>compareMCMCs</code>. When included in <code>compareMCMCs</code>, they are applied <em>before</em> metrics are calculated.</p>
<div id="example" class="section level2">
<h2>Example</h2>
<p>To continue using the toy example above, let us say that one wants to use <code>log(a)</code> for comparisons, and make that conversion for all MCMCs. Typically one would need different conversions for different MCMCs, but in this case we will apply the same conversion to all.</p>
<p>To make this conversion as part of <code>compareMCMCs</code>, we would do the following.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">reparam &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">log_a  =</span> <span class="st">&quot;log(`a`)&quot;</span>, <span class="dt">a =</span> <span class="ot">NULL</span>)</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">conversions &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">nimble =</span> reparam,</a>
<a class="sourceLine" id="cb8-3" data-line-number="3">                    <span class="dt">nimble_slice =</span> reparam,</a>
<a class="sourceLine" id="cb8-4" data-line-number="4">                    <span class="dt">jags =</span> reparam)</a>
<a class="sourceLine" id="cb8-5" data-line-number="5">res &lt;-<span class="st"> </span><span class="kw">compareMCMCs</span>(modelInfo,</a>
<a class="sourceLine" id="cb8-6" data-line-number="6">                    <span class="dt">MCMCs =</span> <span class="kw">c</span>(<span class="st">'jags'</span>, <span class="st">'nimble'</span>, <span class="st">'nimble_slice'</span>),</a>
<a class="sourceLine" id="cb8-7" data-line-number="7">                    <span class="dt">nimbleMCMCdefs =</span> <span class="kw">list</span>(<span class="dt">nimble_slice =</span> <span class="st">'configure_nimble_slice'</span>),</a>
<a class="sourceLine" id="cb8-8" data-line-number="8">                    <span class="dt">conversions =</span> conversions,</a>
<a class="sourceLine" id="cb8-9" data-line-number="9">                    <span class="dt">MCMCcontrol =</span> <span class="kw">list</span>(<span class="dt">inits =</span> <span class="kw">list</span>(<span class="dt">a =</span> <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb8-10" data-line-number="10">                                       <span class="dt">niter =</span> <span class="dv">2000</span>,</a>
<a class="sourceLine" id="cb8-11" data-line-number="11">                                       <span class="dt">burnin =</span> <span class="dv">100</span>))</a>
<a class="sourceLine" id="cb8-12" data-line-number="12"><span class="co">#&gt; building nimble model...</span></a>
<a class="sourceLine" id="cb8-13" data-line-number="13"><span class="co">#&gt; defining model...</span></a>
<a class="sourceLine" id="cb8-14" data-line-number="14"><span class="co">#&gt; Detected y as data within 'constants'.</span></a>
<a class="sourceLine" id="cb8-15" data-line-number="15"><span class="co">#&gt; Adding y as data for building model.</span></a>
<a class="sourceLine" id="cb8-16" data-line-number="16"><span class="co">#&gt; building model...</span></a>
<a class="sourceLine" id="cb8-17" data-line-number="17"><span class="co">#&gt; setting data and initial values...</span></a>
<a class="sourceLine" id="cb8-18" data-line-number="18"><span class="co">#&gt; running calculate on model (any error reports that follow may simply reflect missing values in model variables) ... </span></a>
<a class="sourceLine" id="cb8-19" data-line-number="19"><span class="co">#&gt; checking model sizes and dimensions...</span></a>
<a class="sourceLine" id="cb8-20" data-line-number="20"><span class="co">#&gt; model building finished.</span></a>
<a class="sourceLine" id="cb8-21" data-line-number="21"><span class="co">#&gt; Compiling model graph</span></a>
<a class="sourceLine" id="cb8-22" data-line-number="22"><span class="co">#&gt;    Resolving undeclared variables</span></a>
<a class="sourceLine" id="cb8-23" data-line-number="23"><span class="co">#&gt;    Allocating nodes</span></a>
<a class="sourceLine" id="cb8-24" data-line-number="24"><span class="co">#&gt; Graph information:</span></a>
<a class="sourceLine" id="cb8-25" data-line-number="25"><span class="co">#&gt;    Observed stochastic nodes: 1</span></a>
<a class="sourceLine" id="cb8-26" data-line-number="26"><span class="co">#&gt;    Unobserved stochastic nodes: 1</span></a>
<a class="sourceLine" id="cb8-27" data-line-number="27"><span class="co">#&gt;    Total graph size: 6</span></a>
<a class="sourceLine" id="cb8-28" data-line-number="28"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb8-29" data-line-number="29"><span class="co">#&gt; Initializing model</span></a>
<a class="sourceLine" id="cb8-30" data-line-number="30"><span class="co">#&gt; compiling... this may take a minute. Use 'showCompilerOutput = TRUE' to see C++ compilation details.</span></a>
<a class="sourceLine" id="cb8-31" data-line-number="31"><span class="co">#&gt; compilation finished.</span></a>
<a class="sourceLine" id="cb8-32" data-line-number="32"><span class="co">#&gt; compiling... this may take a minute. Use 'showCompilerOutput = TRUE' to see C++ compilation details.</span></a>
<a class="sourceLine" id="cb8-33" data-line-number="33"><span class="co">#&gt; compilation finished.</span></a>
<a class="sourceLine" id="cb8-34" data-line-number="34"><span class="co">#&gt; |-------------|-------------|-------------|-------------|</span></a>
<a class="sourceLine" id="cb8-35" data-line-number="35"><span class="co">#&gt; |-------------------------------------------------------|</span></a>
<a class="sourceLine" id="cb8-36" data-line-number="36"><span class="co">#&gt; |-------------|-------------|-------------|-------------|</span></a>
<a class="sourceLine" id="cb8-37" data-line-number="37"><span class="co">#&gt; |-------------------------------------------------------|</span></a>
<a class="sourceLine" id="cb8-38" data-line-number="38"></a>
<a class="sourceLine" id="cb8-39" data-line-number="39"><span class="co">## We will look at the result using combineMetrics (see below)</span></a>
<a class="sourceLine" id="cb8-40" data-line-number="40"><span class="co">## rather than generating new html pages.</span></a>
<a class="sourceLine" id="cb8-41" data-line-number="41"><span class="kw">combineMetrics</span>(res)</a>
<a class="sourceLine" id="cb8-42" data-line-number="42"><span class="co">#&gt; $byParameter</span></a>
<a class="sourceLine" id="cb8-43" data-line-number="43"><span class="co">#&gt;           MCMC Parameter     mean   median        sd  CI95_low CI95_upp</span></a>
<a class="sourceLine" id="cb8-44" data-line-number="44"><span class="co">#&gt; 1         jags     log_a 1.546340 1.593444 0.4413050 0.5629718 2.250115</span></a>
<a class="sourceLine" id="cb8-45" data-line-number="45"><span class="co">#&gt; 2       nimble     log_a 1.498592 1.561267 0.4883750 0.3241481 2.249340</span></a>
<a class="sourceLine" id="cb8-46" data-line-number="46"><span class="co">#&gt; 3 nimble_slice     log_a 1.515738 1.572038 0.4284994 0.5308413 2.190923</span></a>
<a class="sourceLine" id="cb8-47" data-line-number="47"><span class="co">#&gt;    ESS_coda efficiency_coda</span></a>
<a class="sourceLine" id="cb8-48" data-line-number="48"><span class="co">#&gt; 1 1145.3172        286329.3</span></a>
<a class="sourceLine" id="cb8-49" data-line-number="49"><span class="co">#&gt; 2  367.4688        183734.4</span></a>
<a class="sourceLine" id="cb8-50" data-line-number="50"><span class="co">#&gt; 3 1900.0000        950000.0</span></a>
<a class="sourceLine" id="cb8-51" data-line-number="51"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb8-52" data-line-number="52"><span class="co">#&gt; $byMCMC</span></a>
<a class="sourceLine" id="cb8-53" data-line-number="53"><span class="co">#&gt;           MCMC min_efficiency_coda mean_efficiency_coda</span></a>
<a class="sourceLine" id="cb8-54" data-line-number="54"><span class="co">#&gt; 1         jags            286329.3             286329.3</span></a>
<a class="sourceLine" id="cb8-55" data-line-number="55"><span class="co">#&gt; 2       nimble            183734.4             183734.4</span></a>
<a class="sourceLine" id="cb8-56" data-line-number="56"><span class="co">#&gt; 3 nimble_slice            950000.0             950000.0</span></a></code></pre></div>
<p>We can see that the parameter is now <code>log_a</code> rather than <code>a</code>.</p>
</div>
<div id="converting-parameters-outside-of-comparemcmcs" class="section level2">
<h2>Converting parameters outside of <code>compareMCMCs</code></h2>
<p>Say we have run <code>compareMCMCs</code> and only later realized we need to convert parameters. For an example, say we want to reverse the conversion to <code>log_a</code> done above. We can do that as follows. <em>Notice that we need to re-compute metrics after applying the conversions, and we must clear the old metrics before re-computing them.</em></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">reparam &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">a  =</span> <span class="st">&quot;exp(`log_a`)&quot;</span>, <span class="dt">log_a =</span> <span class="ot">NULL</span>)</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">conversions &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">nimble =</span> reparam,</a>
<a class="sourceLine" id="cb9-3" data-line-number="3">                    <span class="dt">nimble_slice =</span> reparam,</a>
<a class="sourceLine" id="cb9-4" data-line-number="4">                    <span class="dt">jags =</span> reparam)</a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="kw">applyConversions</span>(res, conversions)</a>
<a class="sourceLine" id="cb9-6" data-line-number="6"><span class="kw">clearMetrics</span>(res)</a>
<a class="sourceLine" id="cb9-7" data-line-number="7"><span class="kw">addMetrics</span>(res) <span class="co"># use default metrics</span></a>
<a class="sourceLine" id="cb9-8" data-line-number="8"><span class="kw">combineMetrics</span>(res) <span class="co">## An easy way to see that it worked</span></a>
<a class="sourceLine" id="cb9-9" data-line-number="9"><span class="co">#&gt; $byParameter</span></a>
<a class="sourceLine" id="cb9-10" data-line-number="10"><span class="co">#&gt;           MCMC Parameter     mean   median       sd CI95_low CI95_upp</span></a>
<a class="sourceLine" id="cb9-11" data-line-number="11"><span class="co">#&gt; 1         jags         a 5.116264 4.920668 1.994402 1.755906 9.488830</span></a>
<a class="sourceLine" id="cb9-12" data-line-number="12"><span class="co">#&gt; 2       nimble         a 4.961097 4.764855 2.085331 1.382861 9.481473</span></a>
<a class="sourceLine" id="cb9-13" data-line-number="13"><span class="co">#&gt; 3 nimble_slice         a 4.943484 4.816457 1.891707 1.700383 8.943468</span></a>
<a class="sourceLine" id="cb9-14" data-line-number="14"><span class="co">#&gt;    ESS_coda efficiency_coda</span></a>
<a class="sourceLine" id="cb9-15" data-line-number="15"><span class="co">#&gt; 1 1021.2116        255302.9</span></a>
<a class="sourceLine" id="cb9-16" data-line-number="16"><span class="co">#&gt; 2  377.6213        188810.7</span></a>
<a class="sourceLine" id="cb9-17" data-line-number="17"><span class="co">#&gt; 3 1715.9940        857997.0</span></a>
<a class="sourceLine" id="cb9-18" data-line-number="18"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb9-19" data-line-number="19"><span class="co">#&gt; $byMCMC</span></a>
<a class="sourceLine" id="cb9-20" data-line-number="20"><span class="co">#&gt;           MCMC min_efficiency_coda mean_efficiency_coda</span></a>
<a class="sourceLine" id="cb9-21" data-line-number="21"><span class="co">#&gt; 1         jags            255302.9             255302.9</span></a>
<a class="sourceLine" id="cb9-22" data-line-number="22"><span class="co">#&gt; 2       nimble            188810.7             188810.7</span></a>
<a class="sourceLine" id="cb9-23" data-line-number="23"><span class="co">#&gt; 3 nimble_slice            857997.0             857997.0</span></a></code></pre></div>
</div>
<div id="how-to-specify-conversions" class="section level2">
<h2>How to specify conversions</h2>
<p>The <code>conversions</code> argument to <code>applyConversions</code> (or to <code>compareMCMCs</code>, which is passed to <code>applyConversions</code>) provides a reasonably flexible system. It should be a named list with names corresponding to MCMCs. Each element is itself of a list, which we call the <em>conversions specification</em>. Each element of the conversions specification defines one conversion, and the elements are processed in order. The name of each element states the name of a column that will be created or modified in the MCMC samples. The element itself can be a character string or call that will be evaluated to generate contents of the column. It can also be <code>NULL</code> or <code>&quot;&quot;</code>, in which case the the named column will be removed.</p>
<p>In a character string or call, it can be important to use backticks around other column names, since they often include indexing notation (using “[]”) as part of the name. For example, to create the log of “beta[2]”, you would include a conversion specification list element “log_beta2 = log(<code>beta[2]</code>)”. The backticks around “beta[2]” identify “beta[2]” as a name rather than the second element of a vector called “beta”. Doing it this way is necessary because columns in MCMC samples have names like “beta[2]”. In the example of above, we do not really need backticks around “a”, but we have used them for illustration.</p>
<p>In the first example above, the first conversion specification element says that <code>log_a</code> will be calculated as <code>log(a)</code>. The second element says that <code>a</code> will be removed.</p>
</div>
</div>
<div id="writing-new-page-component-plugins." class="section level1">
<h1>Writing new page component plugins.</h1>
<p>Writing a plugin to provide a new page component, such as a new figure, to be drawn by <code>make_MCMC_comparison_pages</code> is more complicated than writing a new metric. A page component plugin is a list with up to five elements:</p>
<ul>
<li><code>make</code> is the character name of a function to create the plottable output. This is described more below.</li>
<li><code>fileSuffix</code> is a character suffix to be pasted to the model name to form a filename to which the figure will be output. For example, <code>fileSuffix = '_mySuffix'</code> will lead to an output file called “model_mySuffix.jpg”, if the model is named “model”.</li>
<li><code>linkText</code> is the character text that will be a hyperlink at the top of the comparison page.</li>
<li><code>plot</code> is the name of a function to call to plot the output to a jpeg file such as “model_mySuffix.jpg”. The function takes as input the <code>plottable</code> element of the list returned from <code>make</code>. If no <code>plot</code> function name is provided, the default funciton <code>plot</code> will be used.</li>
<li><code>control</code> is a list that will be passed to the <code>make</code> function. This allows each plugin to offer users arbitrary control via a control list.</li>
</ul>
<div id="more-about-the-make-function." class="section level3">
<h3>More about the <code>make</code> function.</h3>
<p>The <code>make</code> element of a plugin names a function. This function will be called with two arguments. The first is a tidy-formatted combination of metrics from the results list returned by <code>compareMCMCs</code> (or concatenations of such lists). This is created by <code>combineMetrics(results)</code> (see below). The second is the <code>control</code> element of the plugin.</p>
<p>The function should return a list with three elements:</p>
<ul>
<li><p><code>plottable</code> should be an object in one of two formats. If the plugin provides a <code>plot</code> element, then <code>plottable</code> can be any object. It will simply be passed to the function named by <code>plot</code>, which should generate a figure. If the plugin does not provide a <code>plot</code> element, then <code>plottable</code> should be an object such that calling <code>plot()</code> with that object as the argument results in generating a plot. For example, an object returned from <code>ggplot</code> will work.</p></li>
<li><p><code>height</code> should be the height in inches to be passed as the <code>height</code> argument to <code>jpeg</code>.</p></li>
<li><p><code>width</code> should be the width in inches to be passed as the <code>width</code> argument to <code>jpeg</code>.</p></li>
</ul>
<p>The plotting will be done between a call to <code>jpeg</code> and a corresponding call to <code>dev.off()</code>, which closes the output jpeg device opened by calling <code>jpeg</code>.</p>
<div id="format-of-combined-metrics-provided-to-the-make-function." class="section level4">
<h4>Format of combined metrics provided to the <code>make</code> function.</h4>
<p>An example of the combined metrics from the above example is:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw">combineMetrics</span>(res)</a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="co">#&gt; $byParameter</span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="co">#&gt;           MCMC Parameter     mean   median       sd CI95_low CI95_upp</span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="co">#&gt; 1         jags         a 5.116264 4.920668 1.994402 1.755906 9.488830</span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="co">#&gt; 2       nimble         a 4.961097 4.764855 2.085331 1.382861 9.481473</span></a>
<a class="sourceLine" id="cb10-6" data-line-number="6"><span class="co">#&gt; 3 nimble_slice         a 4.943484 4.816457 1.891707 1.700383 8.943468</span></a>
<a class="sourceLine" id="cb10-7" data-line-number="7"><span class="co">#&gt;    ESS_coda efficiency_coda</span></a>
<a class="sourceLine" id="cb10-8" data-line-number="8"><span class="co">#&gt; 1 1021.2116        255302.9</span></a>
<a class="sourceLine" id="cb10-9" data-line-number="9"><span class="co">#&gt; 2  377.6213        188810.7</span></a>
<a class="sourceLine" id="cb10-10" data-line-number="10"><span class="co">#&gt; 3 1715.9940        857997.0</span></a>
<a class="sourceLine" id="cb10-11" data-line-number="11"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb10-12" data-line-number="12"><span class="co">#&gt; $byMCMC</span></a>
<a class="sourceLine" id="cb10-13" data-line-number="13"><span class="co">#&gt;           MCMC min_efficiency_coda mean_efficiency_coda</span></a>
<a class="sourceLine" id="cb10-14" data-line-number="14"><span class="co">#&gt; 1         jags            255302.9             255302.9</span></a>
<a class="sourceLine" id="cb10-15" data-line-number="15"><span class="co">#&gt; 2       nimble            188810.7             188810.7</span></a>
<a class="sourceLine" id="cb10-16" data-line-number="16"><span class="co">#&gt; 3 nimble_slice            857997.0             857997.0</span></a></code></pre></div>
</div>
</div>
<div id="using-a-new-page-component" class="section level3">
<h3>Using a new page component</h3>
<p>Before using a new page component, you must register it using:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw">registerPageComponents</span>(</a>
<a class="sourceLine" id="cb11-2" data-line-number="2">  <span class="kw">list</span>(<span class="dt">myNewComponent =</span> </a>
<a class="sourceLine" id="cb11-3" data-line-number="3">         <span class="kw">list</span>(<span class="dt">make =</span> <span class="st">&quot;myMakeFunction&quot;</span>,</a>
<a class="sourceLine" id="cb11-4" data-line-number="4">              <span class="dt">fileSuffix =</span> <span class="st">&quot;_myPageComponent&quot;</span>,</a>
<a class="sourceLine" id="cb11-5" data-line-number="5">              <span class="dt">linkText =</span> <span class="st">&quot;My new page component.&quot;</span>)</a>
<a class="sourceLine" id="cb11-6" data-line-number="6">       )</a>
<a class="sourceLine" id="cb11-7" data-line-number="7">  )</a>
<a class="sourceLine" id="cb11-8" data-line-number="8"><span class="co">#&gt; &lt;environment: 0x7fe19f895930&gt;</span></a></code></pre></div>
<p>Then the name “myNewComponent” can be included in the character vector argument <code>pageComponents</code> to <code>make_MCMC_comparison_pages</code>.</p>
</div>
<div id="pre-defined-page-components-and-defaults" class="section level3">
<h3>Pre-defined page components and defaults</h3>
<p>The pre-defined page components include:</p>
<ul>
<li>timing (This does not currently work.)</li>
<li>efficiencySummary: Min and mean MCMC efficiencies.</li>
<li>efficiencySummaryAllParams: Min, mean, and parameter-wise MCMC efficiencies.</li>
<li>paceSummaryAllParams: Max, mean, and parameter-wise MCMC paces (pace = 1/efficiency).</li>
<li>efficiencyDetails: Parameter-by-parameter barplots of efficiencies.</li>
<li>posteriorSummaries: Parameter-by-parameter plots of posterior summaries.</li>
</ul>
<p>If the <code>pageComponents</code> argument to <code>make_MCMC_comparison_pages</code> is <code>NULL</code>, the last four of these will be used as a default.</p>
</div>
</div>
<div id="writing-new-mcmc-package-plugins." class="section level1">
<h1>Writing new MCMC package plugins.</h1>
<p>An interface to a new MCMC engine is provided as a function. It accepts the following inputs:</p>
<ul>
<li>runInfo: This is a flexible argument that is not documented (or needed to provide a new plugin) at this time.</li>
<li>MCMCinfo: This is a list with elements <code>niter</code> (number of iterations), <code>thin</code> (thinning interval) and <code>burnin</code> (number of “burn-in” samples to discard).</li>
<li>otherInfo: This is a list with elements as follows (where <code>modelInfo</code> is the <code>modelInfo</code> argument to <code>compareMCMCs</code>):
<ul>
<li><code>Rmodel</code>: This is a nimble model object.</li>
<li><code>data</code>: This is <code>modelInfo$data</code>.</li>
<li><code>constants</code>: This is <code>modelInfo$constants</code>,</li>
<li><code>inits</code>: This is <code>modelInfo$inits</code>,</li>
<li><code>monitorVars</code>: This is a character vector of the variable names of parameters to be monitored and hence included in metrics and comparisons.</li>
<li><code>monitors</code>: This is a character vector of nodes to be monitored. In nimble terminology, if <code>beta</code> is a vector of length 5, and each element is a scalar parameter in the model, then “beta” is the variable and “beta[1]”, …, “beta[5]” are the nodes.</li>
</ul></li>
</ul>
<p>The function should use these arguments to run its MCMC engine and return an <code>MCMCresult</code> object with <code>timing</code> and <code>samples</code> populated. If the <code>MCMC</code> element has been populated, that will be used as the label of the MCMC in metrics and comparison pages. Otherwise the label used in the MCMCs argument to <code>compareMCMCs</code> will be used as the <code>MCMC</code> element.</p>
<p>A new MCMC engine can be registered with <code>registerMCMCengine</code>.</p>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
